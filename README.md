# RecotteShader

RecotteStudioの追加エフェクトです。

## インストール方法

1. RecotteStudioをインストール

1. [WindowsSDK](https://developer.microsoft.com/ja-jp/windows/downloads/windows-10-sdk/)をインストール

1. `build.bat`の`RECOTTE`変数に`fxc.exe`の在り処を書く

1. `build.bat`の実行

1. `install.bat`の実行（管理者権限が求められます）

## 機能

* ブラウン管風シェーダーエフェクト

* 手書き風シェーダーエフェクト

* ナイトビジョン風シェーダーエフェクト

* ゲームボーイ風シェーダーエフェクト

* 境界ぼかしシェーダーエフェクト

* ブルームシェーダーエフェクト


## 開発方法

`uh_effect.*`を複製し、適当にリネームしてください。リネーム後のファイルネームを、`build.bat`と`link.bat`に追記します。
`link.bat`を実行して、RecotteStudioのディレクトリにリンクを張ります。（`install.bat`でもいいですが、毎回管理者権限昇格イベントが発生すると煩わしいので）

複製したHLSLファイルを開き編集します。使える変数は、引数とメインテクスチャとサンプラーcBufferの`t`（時間）ぐらいです。cBufferの中身は`util.hlsl`に書いてありますが、LUAから渡されていない変数も多いようなのであまり当てになりません。基本的には、LUAを経由します。記述できるのはフラグメントシェーダーのみです。

LUA（GUI）とやり取りできる変数はfloat6本＋128bitColor4本です。これではあまりに少ないので、低精度な値を複数詰め込んで、見かけ上のパラメータ数を増やしています。`util.hlsl`の`UnpackedParams`構造体を確認してください。GUIからShaderへのパラメータ受け渡しは`lib.lua`で定義済みなので特に触る必要はありませんが、ラベルとデフォルトだけはオーバーライドしておくと良いと思います。コピーしたLUAファイル内のコメントを好きなところを外して書き換えてください。


HLSLの編集が終わったら、`build.bat`を実行し、シェーダーをコンパイルします。RecotteStudioを再起動して、作ったエフェクトを設定します。この時、対象が映像アセットの場合、uh_dummyのトランジションも一緒に追加してください。すると、シェーダが適用されています。


## メモ

* PSの引数のposは正規化されていない（画面がFHDなら0～1920までをとる）
* PSの引数のuvpとuvは同じ値が入っている
* シェーダー適用されなくなる -> 大概は、コンパイルエラーでCSOが無い、エラーは出ない
* 